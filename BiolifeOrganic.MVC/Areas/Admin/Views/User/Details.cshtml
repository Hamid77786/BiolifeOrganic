@using BiolifeOrganic.Bll.ViewModels.User
@using BiolifeOrganic.Bll.ViewModels.Order
@using BiolifeOrganic.Bll.ViewModels.Wishlist
@using BiolifeOrganic.Bll.ViewModels.UserDiscount
@model UserDetailsViewModel

<div class="row">
    <div class="col-lg-12">
        <h2>@Model.UserName (@Model.Email)</h2>
        <h3>Phone:@Model.PhoneNumber</h3>
        <p>
            Status:
            @if (Model.IsBlocked)
            {
                <span class="badge badge-danger">Blocked</span>
            }
            else
            {
                <span class="badge badge-success">Active</span>
            }
        </p>
    </div>
</div>

<hr />

<!-- Orders -->
<h4>Orders (@Model.Orders.Count)</h4>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Order #</th>
            <th>Date</th>
            <th>Status</th>
            <th>Total</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var order in Model.Orders)
        {
            <tr>
                <td>
                    <a asp-area="Admin"
                       asp-controller="Order"
                       asp-action="Details"
                       asp-route-id="@order.Id">
                        @order.OrderNumber
                    </a>
                </td>
                <td>@order.OrderDate.ToString("dd/MM/yyyy")</td>
                <td>@order.Status</td>
                <td>@order.TotalAmount ₼</td>
                <td>
                    <a asp-area="Admin"
                       asp-controller="Order"
                       asp-action="EditAddress"
                       asp-route-orderId="@order.Id"
                       class="btn btn-sm btn-warning">
                        Edit Address
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>

<hr />

<!-- Wishlist -->
<h4>Wishlist (@(Model.Wishlists.FirstOrDefault()?.Count ?? 0))</h4>

@if (Model.Wishlists.FirstOrDefault()?.Items.Any() ?? false)
{
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Product</th>
                <th>Image</th>
                <th>Price</th>
                <th>Available</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Wishlists.FirstOrDefault()?.Items ?? new List<WishlistItemViewModel>())
            {
                <tr>
                    <td>@item.ProductName</td>
                    <td>
                        <img src="~/images/products/@item.ImageUrl" width="50" height="50" />
                    </td>
                    <td>@item.Price ₼</td>
                    <td>
                        @if (item.IsAvailable)
                        {
                            <span class="badge badge-success">Yes</span>
                        }
                        else
                        {
                            <span class="badge badge-danger">No</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p class="text-muted">This user has no products in their wishlist.</p>
}


<hr />

<!-- Discounts -->
<h4>Discounts (@Model.Discounts.Count)</h4>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Discount Code</th>
            <th>Percentage</th>
            <th>Used</th>
            <th>Used At</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var discount in Model.Discounts)
        {
            <tr>
                <td>@discount.DiscountName</td>
                <td>@discount.DiscountPercentage %</td>
                <td>@(discount.IsUsed ? "Yes" : "No")</td>
                <td>@(discount.UsedAt?.ToString("yyyy-MM-dd") ?? "-")</td>
            </tr>
        }
    </tbody>
</table>
